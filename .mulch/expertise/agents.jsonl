{"type":"failure","description":"Sling must pass --model from agent manifest to claude CLI. Without it, all agents use default model, defeating cost optimization (scouts=haiku) and capability matching (leads=opus).","resolution":"Added --model ${agentDef.model} flag to the claude command string in sling.ts line 312, reading the model from the loaded agent manifest entry.","classification":"tactical","recorded_at":"2026-02-12T20:15:46.380Z","id":"mx-aa807d"}
{"type":"decision","title":"Interactive mode over headless for agent spawning","rationale":"Headless mode (claude -p) prevented hooks from firing, breaking mail injection, metrics, logs, and lastActivity. Interactive mode with sendKeys beacon enables full hook lifecycle.","classification":"tactical","recorded_at":"2026-02-12T20:31:42.493Z","id":"mx-1749f9"}
{"type":"failure","description":"Beacon sendKeys multiline bug: tmux send-keys with multiline text inserts newlines into Claude Code TUI input buffer but does not auto-submit.","resolution":"Filed as overstory-y2ob (P1). Workaround: send separate Enter via tmux send-keys after the beacon. Proper fix: flatten beacon to single line or add explicit Enter delay in sendKeys.","classification":"tactical","recorded_at":"2026-02-12T21:12:30.173Z","id":"mx-f8edbf"}
{"type":"failure","description":"Agent worktrees lack node_modules; quality gate commands must use bun run variants (bun run lint, bun run typecheck) not direct biome/tsc calls","resolution":"Updated all agent definitions and overlay.ts formatQualityGates() to use bun run lint and bun run typecheck. The bun run variants resolve commands through package.json scripts, which finds the binaries via bun module resolution even without node_modules in the worktree.","classification":"tactical","recorded_at":"2026-02-12T21:20:18.642Z","id":"mx-744929"}
{"type":"decision","title":"native-team-tool-blocking","rationale":"All overstory agents get Claude Code native team/task tools (Task, TeamCreate, SendMessage, etc.) blocked via PreToolUse hooks. Enforces delegation through overstory sling rather than bypassing the orchestration system. Applied to all capabilities. (overstory-x6xm)","classification":"tactical","recorded_at":"2026-02-13T14:47:26.953Z","id":"mx-ce7db6"}
{"type":"pattern","name":"progressive-nudging-escalation","description":"Progressive nudging pattern: instead of binary stalled->terminate, use escalationLevel (0-3) with stalledSince timestamp to advance through warn->nudge->escalate->terminate stages. Time between stages controlled by nudgeIntervalMs config. Level calculation: Math.min(Math.floor(elapsedMs/nudgeIntervalMs), maxLevel). Each stage has a distinct executeEscalationAction handler. Reset escalation on agent recovery (action=none + stalledSince != null) or termination.","classification":"tactical","recorded_at":"2026-02-13T15:01:28.800Z","id":"mx-cc8540"}
{"type":"decision","title":"Hierarchy enforcement via validateHierarchy in sling.ts","rationale":"Coordinator was short-circuiting hierarchy by directly spawning builders. Code enforcement in sling.ts (HierarchyError when parentAgent is null and capability != lead) prevents this. --force-hierarchy flag available for debugging.","classification":"tactical","recorded_at":"2026-02-13T15:50:13.666Z","id":"mx-c9698d"}
{"type":"pattern","name":"lead-three-phase-workflow","description":"Lead three-phase workflow: Scout→Build→Verify. Phase 1: spawn scout to explore, wait for result mail. Phase 2: write specs from findings, spawn builders with file scope. Phase 3: monitor, optionally review, signal merge_ready to coordinator. Leads own spec production — coordinator never writes specs.","classification":"tactical","recorded_at":"2026-02-13T15:50:19.732Z","id":"mx-7801cd"}
{"type":"failure","description":"clean.test.ts uses real killAllTmuxSessions() with no mocks. During dogfooding, bun test kills all live overstory-prefixed tmux sessions — the root cause of the coordinator crash.","resolution":"Mock tmux in clean.test.ts or use fake session name prefix (mx-f1dccb). Tests that assume 'no tmux server running' become destructive when run inside a live swarm.","classification":"tactical","recorded_at":"2026-02-14T04:14:06.048Z","id":"mx-f468c3"}
{"type":"pattern","name":"Builder scope creep causes merge failures","description":"Builders sometimes create out-of-scope commits (e.g. adding community files, modifying package.json) alongside their implementation commit. When this happens, overstory merge fails due to .beads/issues.jsonl conflicts. Prevention: builder specs should explicitly state no out-of-scope changes. Recovery: use cherry-pick leads to extract clean commits.","classification":"tactical","recorded_at":"2026-02-14T06:41:34.186Z","tags":["builder","scope-creep","prevention"],"id":"mx-68f258"}
{"type":"pattern","name":"orchestrator-mail-alias-mismatch","description":"Leads send mail to 'orchestrator' by default, not 'coordinator'. The coordinator agent name and the default recipient alias are mismatched. Use 'overstory mail list --to orchestrator --unread' to check for coordinator-bound messages, not '--agent coordinator'.","classification":"tactical","recorded_at":"2026-02-16T15:59:13.588Z","id":"mx-5a5a48"}
{"type":"failure","description":"Task dependency sequencing issue: logs-wiring task assigned before logs.ts implementation existed, causing TypeScript and test failures. Wiring tasks should be sequenced AFTER implementation tasks.","resolution":"Agent completed wiring correctly within file scope, documented blockers in commit message and bd close reason, sent status updates to parent. For future: ensure implementation tasks complete before wiring tasks, or include stub creation in wiring scope.","classification":"tactical","recorded_at":"2026-02-16T21:15:54.867Z","id":"mx-025941"}
{"type":"convention","content":"Completion Protocol and Failure Modes must be kept in sync: when adding a new required gate to agent workflows, update both the numbered Completion Protocol steps (insert and renumber) and add a corresponding named failure mode (e.g., MISSING_MULCH_RECORD for skipping mulch record)","classification":"tactical","recorded_at":"2026-02-16T21:44:45.008Z","id":"mx-ebfa06"}
{"type":"failure","description":"Leads consistently exit after completing only 1 of N assigned issues. Pattern observed 3 times in phase1-hardening batch: agent-workflow-lead (1/3), observability-lead (1/3), agent-defs-lead-2 (1/2).","resolution":"Coordinator must monitor and re-dispatch replacement leads for remaining issues. Consider spawning 1 lead per issue instead of batching multiple issues to one lead for more reliable completion.","classification":"tactical","recorded_at":"2026-02-16T22:00:38.084Z","id":"mx-f9eb1b"}
{"type":"failure","description":"Reviewers spawned from canonical branch cannot see builder changes on builder branches. Reviewer for leadmd-builder checked canonical agents/lead.md instead of builder worktree copy, producing false FAIL.","resolution":"Reviewers need explicit instructions to check the builder worktree path or use git diff against the builder branch, not their own worktree copy.","classification":"tactical","recorded_at":"2026-02-17T15:51:19.474Z","evidence":{"bead":"overstory-9sct"},"id":"mx-0bc6ae"}
{"type":"convention","content":"Agent definition reinforcement pattern: when an agent consistently fails to follow instructions, strengthen language in multiple coordinated sections: (1) section title (add MANDATORY marker), (2) intro (add production failure data), (3) step language (change descriptive to imperative with MUST), (4) failure mode descriptions (add production data and structural enforcement notes), (5) completion protocol (add explicit verification step), (6) constraints (add redundant requirement). The lead.md review enforcement update demonstrates this pattern with 2/98 production data.","classification":"tactical","recorded_at":"2026-02-17T16:07:15.533Z","evidence":{"bead":"overstory-dt9o"},"id":"mx-99d99a"}
{"type":"convention","content":"Agent definition reinforcement via complexity tiers: when leads consistently over-spawn (scouts/reviewers for simple tasks), add a Task Complexity Assessment section defining simple/moderate/complex tiers with explicit action for each. Simple tasks: lead does directly. Moderate: builder only with self-verification. Complex: full Scout→Build→Verify pipeline.","classification":"tactical","recorded_at":"2026-02-21T14:43:50.396Z","evidence":{"commit":"286fd84"},"outcomes":[{"status":"success","agent":"agent-def-builder"}],"id":"mx-8c0a17"}
{"type":"convention","content":"When dispatching leads with overlapping commit targets (e.g., both will append mulch records to the same JSONL file), merge the first branch before slinging the second to avoid append conflicts. Alternatively, accept that a post-merge conflict resolution step is needed.","classification":"tactical","recorded_at":"2026-02-21T15:21:13.552Z","evidence":{"bead":"overstory-4ygi"},"id":"mx-62fe65"}
{"type":"failure","description":"Leads cannot find seeds issues created in canonical root: when coordinator runs sd create then spawns a lead, the worktree branches from HEAD which may not include uncommitted .seeds/ changes.","resolution":"Dispatch mail must embed full task details inline rather than relying on sd show. Commit .seeds/ changes before spawning leads, or use self-contained dispatch mail.","classification":"tactical","recorded_at":"2026-02-24T14:10:00.558Z","id":"mx-cff752"}
{"type":"convention","content":"Coordinator dispatch mail must be self-contained: embed full bug details, file paths, line numbers, and fix instructions directly in the mail body. Never rely on agents calling sd show or reading specs from the worktree — issues created after worktree branch point are invisible to agents. Include explicit do-NOT-use-AskUserQuestion warning for non-interactive agents.","classification":"tactical","recorded_at":"2026-02-24T14:10:02.286Z","id":"mx-5d41f1"}
{"type":"pattern","name":"builder-retry-on-stall","description":"Lead agent builder retry: when a builder stalls 24min with no commits, stop and respawn with detailed instructions including exact code changes in dispatch mail","classification":"tactical","recorded_at":"2026-02-24T20:00:13.899Z","outcomes":[{"status":"success","agent":"test-fix-lead"}],"id":"mx-e7b647"}
{"type":"convention","content":"Builder timeout recovery pattern: when a builder works 20+ minutes with no commits and no completion mail, the lead should stop it (overstory stop) and spawn a replacement builder for the remaining work. Builder cmdr-fix-2 was stuck for 24 minutes before being replaced by cmdr-fix-3 which completed in 17 minutes.","classification":"tactical","recorded_at":"2026-02-24T20:06:42.252Z","id":"mx-790ca8"}
{"classification":"tactical","recorded_at":"2026-02-26T17:56:53.758Z","tags":["watchdog","auto-recorded"],"type":"failure","description":"Agent: coordinator\nCapability: coordinator\nFailure reason: Process terminated\nDetected by: Tier 0 (process death)","resolution":"","id":"mx-9ca813"}
{"type":"convention","content":"Agent base definitions include --classification guidance for ml record: foundational (stable cross-session conventions), tactical (session-specific patterns, default), observational (unverified one-off findings). Read-only agents (scout, reviewer) suggest classification in result mail for parents to record accurately.","classification":"tactical","recorded_at":"2026-02-26T18:33:01.815Z","outcomes":[{"status":"success","agent":"classification-builder"}],"id":"mx-56b9d1"}
{"type":"convention","content":"When dispatching 4+ leads that all append to .mulch/expertise/cli.jsonl, the first merge succeeds but subsequent merges fail due to JSONL append conflicts unless the working tree on main is clean. Coordinator must commit accumulated state between the first pricing-type merge and subsequent branch merges.","classification":"tactical","recorded_at":"2026-02-27T02:01:53.110Z","id":"mx-9acfdc"}
